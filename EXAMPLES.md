# Examples

## Simple `void` function example with usage

### Your PostgreSQL routine with single input parameter

```sql
create or replace function do_some_work(_input_param bigint)
returns void as
$$
begin
    -- do some work
end
$$
language plpgsql;
comment on function do_some_work(bigint) is 'function that does some work';
```

### Generated module `DoSomeWork.cs` will look like this

```csharp
// <auto-generated at 2020-06-14T11:59:46.5499249+02:00 />
using System;
using System.Linq;
using System.Collections.Generic;
using System.Threading.Tasks;
using Norm.Extensions;
using Npgsql;

namespace PgRoutinerTest
{
    public static class PgRoutineDoSomeWork
    {
        public const string Name = "do_some_work";

        /// <summary>
        /// plpgsql function "do_some_work"
        /// function that does some work
        /// </summary>
        public static void DoSomeWork(this NpgsqlConnection connection, long inputParam)
        {
            connection
                .Execute(Name, ("_input_param", inputParam));
        }

        /// <summary>
        /// plpgsql function "add_case_exams"
        /// function that does some work
        /// </summary>
        public static async ValueTask DoSomeWorkAsync(this NpgsqlConnection connection, long inputParam)
        {
            await connection
                .ExecuteAsync(Name, ("_input_param", inputParam));
        }
    }
}
```

### Usage

- You may use following function as normal connection object extension, and you'll have full static type checking and IDE support:

```csharp
using var connection = new NpgsqlConnection(connectionString);
connection.DoSomeWork(1);
```

## Function parameter overload example

- Function parameter overloads will be generated in same module. So, if we add more functions with same name and different parameters:

```sql
create or replace function do_some_work(_text text)
returns void as
$$
begin
    -- do some work
end
$$
language plpgsql;
comment on function do_some_work(text) is 'function that does some work and receives text';

create or replace function do_some_work(_input_param bigint, _text text)
returns void as
$$
begin
    -- do some work
end
$$
language plpgsql;
comment on function do_some_work(bigint, text) is 'function that does some work overload';
```

### Resulting class with overload functions

```csharp
    public static class PgRoutineDoSomeWork
    {
        public const string Name = "do_some_work";

        /// <summary>
        /// plpgsql function "do_some_work"
        /// function that does some work
        /// </summary>
        public static void DoSomeWork(this NpgsqlConnection connection, long inputParam)
        {
            connection
                .Execute(Name, ("_input_param", inputParam));
        }

        /// <summary>
        /// plpgsql function "add_case_exams"
        /// function that does some work
        /// </summary>
        public static async ValueTask DoSomeWorkAsync(this NpgsqlConnection connection, long inputParam)
        {
            await connection
                .ExecuteAsync(Name, ("_input_param", inputParam));
        }

        /// <summary>
        /// plpgsql function "do_some_work"
        /// function that does some work overload
        /// </summary>
        public static void DoSomeWork(this NpgsqlConnection connection, long inputParam, string text)
        {
            connection
                .Execute(Name, ("_input_param", inputParam), ("_text", text));
        }

        /// <summary>
        /// plpgsql function "add_case_exams"
        /// function that does some work overload
        /// </summary>
        public static async ValueTask DoSomeWorkAsync(this NpgsqlConnection connection, long inputParam, string text)
        {
            await connection
                .ExecuteAsync(Name, ("_input_param", inputParam), ("_text", text));
        }
    }
```

## Returning value

### PostgreSQL Function that returns bigint number

```sql
create or replace function calculate_some_number(_input_param bigint) returns bigint as
$$
begin
    -- calculate the number
    return _result;
end
$$
language plpgsql;
comment on function calculate_some_number(bigint) is 'calculates some number';
```

### Generated extension function that return long number

```csharp
    public static class PgRoutineCalculateSomeNumber
    {
        public const string Name = "calculate_some_number";

        /// <summary>
        /// plpgsql function "calculate_some_number"
        /// calculates some number
        /// </summary>
        public static long CalculateSomeNumber(this NpgsqlConnection connection, long inputParam)
        {
            return connection
                .Single<long>(Name, ("_input_param", inputParam));
        }

        /// <summary>
        /// plpgsql function "calculate_some_number"
        /// calculates some number
        /// </summary>
        public static async ValueTask<long> CalculateSomeNumberAsync(this NpgsqlConnection connection, long inputParam)
        {
            return await connection
                .SingleAsync<long>(Name, ("_input_param", inputParam));
        }
    }
```

## Returning anonymous recordset

### SQL function returning anonymous table

```sql
create or replace function get_some_data(_input_param bigint) returns table (
    id bigint,
    date timestamptz,
    text text
)
as
$$
select
    id, date, text
from
    some_table
where
    _input_param is null or id = _input_param
$$
language sql;
comment on function get_some_data(bigint) is 'returns some data';
```

### Module will include model class

```csharp
    public class GetSomeDataResult
    {
       public long Id { get; set; }
       public DateTime Date { get; set; }
       public string Text { get; set; }
    }

    public static class PgRoutineGetSomeData
    {
        public const string Name = "get_some_data";

        /// <summary>
        /// sql function "get_some_data"
        /// returns some data
        /// </summary>
        public static IEnumerable<GetSomeDataResult> GetSomeData(this NpgsqlConnection connection, long inputParam)
        {
            return connection
                .Read<long, DateTime, string>(Name, ("_input_param", inputParam))
                .Select(tuple => new GetSomeDataResult
                {
                    Id = tuple.Item1,
                    Date = tuple.Item2,
                    Text = tuple.Item3
                });
        }

        /// <summary>
        /// sql function "get_some_data"
        /// returns some data
        /// </summary>
        public static  IAsyncEnumerable<GetSomeDataResult> GetSomeDataAsync(this NpgsqlConnection connection, long inputParam)
        {
            return  connection
                .ReadAsync<long, DateTime, string>(Name, ("_input_param", inputParam))
                .Select(tuple => new GetSomeDataResult
                {
                    Id = tuple.Item1,
                    Date = tuple.Item2,
                    Text = tuple.Item3
                });
        }
    }
```

## Returning table

### SQL function returning normal table

```sql
create table some_table (
    id bigint,
    date timestamptz,
    text text
)

create or replace function get_some_table(_input_param bigint)
returns setof some_table
as
$$
select
    id, date, text
from
    some_table
where
    _input_param is null or id = _input_param
$$
language sql;
comment on function get_some_table(bigint) is 'returns data from some_table';
```

### Module will include `some_table` model

```csharp
    public class SomeTable
    {
       public long Id { get; set; }
       public DateTime Date { get; set; }
       public string Text { get; set; }
    }

    public static class PgRoutineGetSomeTable
    {
        public const string Name = "get_some_table";

        /// <summary>
        /// sql function "get_some_data"
        /// returns data from some_table
        /// </summary>
        public static IEnumerable<SomeTable> GetSomeTable(this NpgsqlConnection connection, long inputParam)
        {
            return connection
                .Read<long, DateTime, string>(Name, ("_input_param", inputParam))
                .Select(tuple => new SomeTable
                {
                    Id = tuple.Item1,
                    Date = tuple.Item2,
                    Text = tuple.Item3
                });
        }

        /// <summary>
        /// sql function "get_some_data"
        /// returns data from some_table
        /// </summary>
        public static  IAsyncEnumerable<SomeTable> GetSomeTableAsync(this NpgsqlConnection connection, long inputParam)
        {
            return  connection
                .ReadAsync<long, DateTime, string>(Name, ("_input_param", inputParam))
                .Select(tuple => new SomeTable
                {
                    Id = tuple.Item1,
                    Date = tuple.Item2,
                    Text = tuple.Item3
                });
        }
    }
```
